/*
 * Amaru Basic Malware Detection Rules
 * Description: Example YARA rules for detecting common malware patterns
 * Author: Amaru Contributors
 * License: GPL-2.0
 */

rule SuspiciousStrings {
    meta:
        description = "Detects strings commonly found in malware"
        severity = "medium"
        author = "Amaru Project"
    
    strings:
        $cmd_shell1 = "cmd.exe" nocase
        $cmd_shell2 = "powershell.exe" nocase
        $cmd_shell3 = "wscript.exe" nocase
        $susp_technique1 = "CreateRemoteThread" nocase
        $susp_technique2 = "VirtualAlloc" nocase
        $susp_technique3 = "WriteProcessMemory" nocase
        $registry1 = "CurrentVersion\\Run" nocase
        $registry2 = "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" nocase
        $encoded1 = "base64" nocase
        $encoded2 = "b64decode" nocase
        
    condition:
        uint16(0) == 0x5A4D and // Check for MZ header (PE file)
        filesize < 2MB and // Not too large
        (
            (2 of ($cmd_shell*)) or 
            (2 of ($susp_technique*)) or
            (any of ($registry*) and any of ($encoded*))
        )
}

rule RansomwareIndicators {
    meta:
        description = "Detects common indicators of ransomware"
        severity = "high"
        author = "Amaru Project"
    
    strings:
        $ransom_note1 = "your files have been encrypted" nocase wide ascii
        $ransom_note2 = "pay the ransom" nocase wide ascii
        $ransom_note3 = "bitcoin" nocase wide ascii
        $ransom_note4 = "decrypt your files" nocase wide ascii
        $ransom_note5 = "recover your files" nocase wide ascii
        $file_ext1 = ".encrypted" nocase wide ascii
        $file_ext2 = ".locked" nocase wide ascii
        $file_ext3 = ".crypt" nocase wide ascii
        
    condition:
        2 of ($ransom_note*) or any of ($file_ext*)
}

rule KeyloggerStrings {
    meta:
        description = "Detects strings commonly found in keyloggers"
        severity = "high"
        author = "Amaru Project"
    
    strings:
        $func1 = "GetAsyncKeyState" nocase
        $func2 = "SetWindowsHookEx" nocase
        $func3 = "GetKeyboardState" nocase
        $func4 = "WH_KEYBOARD" nocase
        $file1 = "keylog" nocase
        $file2 = "logged_keys" nocase
    
    condition:
        uint16(0) == 0x5A4D and
        (2 of ($func*) or any of ($file*))
} 